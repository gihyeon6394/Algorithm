# 3. 균형 탐색 트리

- 2-3 탐색 트리
- 레드-블랙 BST
- 구현
- 삭제
- 레드-블랙 BST의 속성

---

- BST는 최악의 조건에서 성능 문제가 있음 (노드가 무작위적이지 않을 때)
- 트리 생성 시 키 삽입 순서에 관계업이 로그 시간 성능을 보장하는 BST
    - 즉, N개의 노드가 있는 트리의 높이는 ~logN

## 2-3 탐색 트리

![img_23.png](img_23.png)

- 2-3트리는 최악의 조건에서도 좋은 성능을 보임 (최악의 조건 : 노드가 무작위적이지 않을 때)
- e.g. 10억개의 키를 가진 2-3트리의 높이는 19~30 사이 밖에 안됨

![img_15.png](img_15.png)

- 2-노드 : 표준 BST, 키 하나에 두개의 링크
- 3-노드 : 두개의 키와 세개의 링크

#### 정의

![img_16.png](img_16.png)

- 2-3 탐색 트리는 공백이거나 (2-노드 or 3-노드)로 구성
- 2-노드 : 하나의 키, 두개의 링크
    - 왼쪽 링크 : 더 작은 키를 담는 2-3 탐색 트리
    - 오른쪽 링크 : 더 큰 키를 담는 2-3 탐색 트리
- 3-노드 : 두개의 키, 세개의 링크
    - 왼쪽 링크 : 더 작은 키를 담는 2-3 탐색 트리
    - 중간 링크 : 두 개의 키 사이의 키를 담는 2-3 탐색 트리
    - 오른쪽 링크 : 더 큰 키를 담는 2-3 탐색 트리
- **완전히 균형 잡힌** 2-3 탐색 트리는 뿌리부터 null 링크까지의 거리가 모두 동일
    - 완전히 균형 잡히다 : 뿌리로부터 모든 리프까지의 거리가 동일
- **2-3 트리 : 완전히 규형잡힌 2-3 탐색 트리**

### 탐색

1. 트리에 키가 존재하는지 알기 위해 뿌리 노드의 키드로가 비교
2. 그 중 하나와 동일하면, 탐색 성공
3. 그렇지 않으면, 적합한 부분 트리 탐색
4. 링크가 null이면, 탐색 실패

### 2-노드로의 삽입

![img_17.png](img_17.png)

- 탐색 실패 후의 바닥에 새로운 노드 삽입해 연결하면 완전 균형 상태가 망가짐
- 탐색 실패 노드가 2-노드면, 3-노드로 변환하여 키를 삽입
- 탐색 실패 노드가 3-노드면, 추가 작업 필요 (하기 참조)

### 한개의 3-노드로 구성된 트리로의 삽입

![img_18.png](img_18.png)

1. 임시로 4-노드를 만듦 (새로운 키 추가)
2. 4-노드를 3개의 2-노드로 분리
3. 결과 : 높이가 1 증가한 2-3 트리

### 2-노드를 부모로 가진 3-노드로의 삽입

![img_19.png](img_19.png)

### 3-노드를 부모로 가진 3-노드로의 삽입

![img_20.png](img_20.png)

1. 임시로 4-노드를 만듦 (새로운 키 추가)
2. 중간 키를 부모 노드로 옮김 (부모 노드가 3-노드가 됨)
3. 결과 : 부모 노드가 3-노드가 되고, 자식노드는 2-노드로 분할됨
    - 중요 : 중간 키가 부모로 이동되어 완전 균형 상태가 유지됨

### 뿌리 노드의 분할

![img_21.png](img_21.png)

- 트리를 거슬러 뿌리까지 갔지만 모두 3-노드인 경우

1. 뿌리 노드를 임시로 4-노드로 만듦 (3-노드 한개로 이루어진 트리에 새로운 키를 삽입하는 경우와 동일하게 움직임)
2. 임시 4-노드를 3개의 2-노드로 분할
3. 결과 : 높이가 1 증가한 2-3 트리

### 지역 변환

![img_22.png](img_22.png)

- 임시 4-노드를 분할하는 경우의 수 6가지
    - 4-노드가 루트 노드
    - 2-노드의 왼쪽
    - 2-노드의 오른쪽
    - 3-노드의 왼쪽
    - 3-노드의 중간
    - 3-노드의 오른쪽
- 2-3 트리의 삽입 알고리즘에서 변환 작업은 순수하게 지역적이다
    - 즉, 지정된 노드와 링크 외에 검사하거나 변경할 노드가 없음
- 각 변화마다 변경되는 링크의 수는 작은 상숫값 이하로 제한됨

### 전역 속성

- 지역 변환을 통해 전체 트리가 완전 균형을 이루게 함
- 뿌리 노드가 3개의 2-노드로 변환 시에만 예외적으로 뿌리에서 null까지의 모든 거리가 +1
- 즉, 모든 지역변환들은 전체 트리의 정렬 속성과 완전 균형 속성을 유지한다는 것이 알고리즘의 핵심

#### 명제 : 2-3트리에서 N개로의 키로 탐색, 삽입 작업시 방몬 노드 수가 최대 logN

- 표준 BST와 다른점 : 아래에서 위로 자람
    - 키를 표준 BST 기준 최악의 경우로 삽입해도 (오름차순으로 삽입) 높이가 logN을 넘지 않음
- 즉, 균형 트리는 표준 BST의 최악의 조건에서 성능을 보장할 수 있는 방법이 될 수 있음

## 레드-블랙 BST

## 구현

## 삭제

## 레드-블랙 BST의 속성
